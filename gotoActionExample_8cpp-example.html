<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AriaCoda: gotoActionExample.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AriaCoda
   &#160;<span id="projectnumber">cdf8a12May11,2021</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('gotoActionExample_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">gotoActionExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Uses ArActionGoto or ArActionGotoStraight (modify code to switch) to drive the robot in a squareThis program will make the robot drive in a 2.5x2.5 meter square by setting each corner in turn as the goal for the action. It also uses speed limiting actions to avoid collisions. After some time, it cancels the goal (and the robot stops due to a stopping action) and exits.</p>
<p>You can modify the code below to change the type of <code>gotoPoseAction</code> to either ArActionGotoStraight or ArActionGoto to compare these if you wish. (These are slightly different actions with similar interfaces; generally ArActionGotoStraight is preferred, and has a few more options.)</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Adept MobileRobots Robotics Interface for Applications (ARIA)</span></div>
<div class="line"><span class="comment">Copyright (C) 2004-2005 ActivMedia Robotics LLC</span></div>
<div class="line"><span class="comment">Copyright (C) 2006-2010 MobileRobots Inc.</span></div>
<div class="line"><span class="comment">Copyright (C) 2011-2015 Adept Technology, Inc.</span></div>
<div class="line"><span class="comment">Copyright (C) 2016-2018 Omron Adept Technologies, Inc.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">     This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">     it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">     the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><span class="comment">     (at your option) any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">     This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">     but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">     GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">     You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">     along with this program; if not, write to the Free Software</span></div>
<div class="line"><span class="comment">     Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="preprocessor">#include &quot;Aria/Aria.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  Aria::init();</div>
<div class="line">  ArArgumentParser parser(&amp;argc, argv);</div>
<div class="line">  parser.loadDefaultArguments();</div>
<div class="line">  ArRobot robot;</div>
<div class="line">  ArAnalogGyro gyro(&amp;robot);</div>
<div class="line">  ArSonarDevice sonar;</div>
<div class="line">  ArRobotConnector robotConnector(&amp;parser, &amp;robot);</div>
<div class="line">  ArLaserConnector laserConnector(&amp;parser, &amp;robot, &amp;robotConnector);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Connect to the robot, get some initial data from it such as type and name,</span></div>
<div class="line">  <span class="comment">// and then load parameter files for this robot.</span></div>
<div class="line">  <span class="keywordflow">if</span>(!robotConnector.connectRobot())</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Terse, <span class="stringliteral">&quot;gotoActionExample: Could not connect to the robot.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span>(parser.checkHelpAndWarnUnparsed())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// -help not given</span></div>
<div class="line">        Aria::logOptions();</div>
<div class="line">        Aria::exit(1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!Aria::parseArgs() || !parser.checkHelpAndWarnUnparsed())</div>
<div class="line">  {</div>
<div class="line">    Aria::logOptions();</div>
<div class="line">    Aria::exit(1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;gotoActionExample: Connected to robot.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  robot.addRangeDevice(&amp;sonar);</div>
<div class="line">  robot.runAsync(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Collision avoidance actions at higher priority</span></div>
<div class="line">  ArActionLimiterForwards limiterAction(<span class="stringliteral">&quot;speed limiter near&quot;</span>, 300, 600, 250);</div>
<div class="line">  ArActionLimiterForwards limiterFarAction(<span class="stringliteral">&quot;speed limiter far&quot;</span>, 300, 1100, 400);</div>
<div class="line">  ArActionLimiterTableSensor tableLimiterAction;</div>
<div class="line">  robot.addAction(&amp;tableLimiterAction, 100);</div>
<div class="line">  robot.addAction(&amp;limiterAction, 95);</div>
<div class="line">  robot.addAction(&amp;limiterFarAction, 90);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Goto action at lower priority</span></div>
<div class="line">  <span class="comment">//ArActionGoto gotoPoseAction(&quot;goto&quot;);</span></div>
<div class="line">  ArActionGotoStraight gotoPoseAction(<span class="stringliteral">&quot;gotostraight&quot;</span>);</div>
<div class="line">  robot.addAction(&amp;gotoPoseAction, 50);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Stop action at lower priority, so the robot stops if it has no goal</span></div>
<div class="line">  ArActionStop stopAction(<span class="stringliteral">&quot;stop&quot;</span>);</div>
<div class="line">  robot.addAction(&amp;stopAction, 40);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  <span class="comment">// turn on the motors, turn off amigobot sounds</span></div>
<div class="line">  robot.enableMotors();</div>
<div class="line">  robot.comInt(ArCommands::SOUNDTOG, 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">int</span> duration = 30000; <span class="comment">//msec</span></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Going to four goals in turn for %d seconds, then cancelling goal and exiting.&quot;</span>, duration/1000);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line">  <span class="keywordtype">int</span> goalNum = 0;</div>
<div class="line">  ArTime start;</div>
<div class="line">  start.setToNow();</div>
<div class="line">  <span class="keywordflow">while</span> (Aria::getRunning()) </div>
<div class="line">  {</div>
<div class="line">    robot.lock();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Choose a new goal if this is the first loop iteration, or if we </span></div>
<div class="line">    <span class="comment">// achieved the previous goal.</span></div>
<div class="line">    <span class="keywordflow">if</span> (first || gotoPoseAction.haveAchievedGoal())</div>
<div class="line">    {</div>
<div class="line">      first = <span class="keyword">false</span>;</div>
<div class="line">      goalNum++;</div>
<div class="line">      <span class="keywordflow">if</span> (goalNum &gt; 4)</div>
<div class="line">        goalNum = 1; <span class="comment">// start again at goal #1</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// set our positions for the different goals</span></div>
<div class="line">      <span class="keywordflow">if</span> (goalNum == 1)</div>
<div class="line">        gotoPoseAction.setGoal(ArPose(2500, 0));</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goalNum == 2)</div>
<div class="line">        gotoPoseAction.setGoal(ArPose(2500, 2500));</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goalNum == 3)</div>
<div class="line">        gotoPoseAction.setGoal(ArPose(0, 2500));</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (goalNum == 4)</div>
<div class="line">        gotoPoseAction.setGoal(ArPose(0, 0));</div>
<div class="line"> </div>
<div class="line">      ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Going to next goal at %.0f %.0f&quot;</span>, </div>
<div class="line">            gotoPoseAction.getGoal().getX(), gotoPoseAction.getGoal().getY());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(start.mSecSince() &gt;= duration) {</div>
<div class="line">      ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;%d seconds have elapsed. Cancelling current goal, waiting 3 seconds, and exiting.&quot;</span>, duration/1000);</div>
<div class="line">      gotoPoseAction.cancelGoal();</div>
<div class="line">      robot.unlock();</div>
<div class="line">      ArUtil::sleep(3000);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    robot.unlock();</div>
<div class="line">    ArUtil::sleep(100);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Robot disconnected or time elapsed, shut down</span></div>
<div class="line">  Aria::exit(0);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
